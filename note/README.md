# Сервис уведомлений "note"

Проект демонстрирует архитектуру гибридного сервиса уведомлений для мгновенных событий, отложенных и массовых рассылок и административной панели.

## Запуск

```bash
docker-compose up --build
```

По умолчанию сервисы доступны:
- API и админка: http://localhost:8083
- Flower мониторинг очереди Celery: http://localhost:5557
- RabbitMQ management UI: http://localhost:15672 (guest/guest)

Список переменных окружения находится в файле `.env.example`.

## Компоненты

- `api` — FastAPI-приложение, объединяющее публичное API событий и административную панель.
- `worker` — Celery-воркер, который получает задачи из очереди и отправляет уведомления.
- `scheduler` — генератор автоматических событий, выполняющийся по расписанию.
- `db` — PostgreSQL для хранения шаблонов, кампаний, пользовательских настроек и логов отправки.
- `rabbitmq` — брокер сообщений с Dead Letter Exchange для надёжной доставки.
- `redis` — бэкенд результатов Celery и кэш пользовательских настроек.

## Быстрый обзор API

- `POST /api/v1/events/instant` — мгновенные уведомления по событию.
- `POST /api/v1/events/bulk` — массовая рассылка по заранее заданным пользователям.
- `POST /api/v1/events/personal` — персонализированное уведомление для конкретного пользователя.
- `POST /api/v1/templates` — создание шаблонов сообщений.
- `POST /api/v1/campaigns` — создание кампаний с отложенной или повторяющейся отправкой.
- `GET /api/v1/deliveries/{user_id}` — получение истории уведомлений пользователем.

## Точки интеграции

- **Авторизация**: worker обращается к сервису авторизации по REST/gRPC для получения email и имени пользователя перед отправкой.
- **Контент**: API получает `content_id` и подставляет данные о фильмах из каталога, вызывая соответствующий сервис.

## Тестирование

Внутренние проверки оформлены в модуле `note/api/app/services/tests` (минимальные заглушки). При необходимости используйте `pytest` внутри контейнера API.
